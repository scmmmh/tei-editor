<div class="tei-editor">
  <div>
    <AriaMenu @class="tei-editor-menubar">
      <AriaMenuAction @tabindex="0" @label="Undo"><MdiIcon @name="Undo"/></AriaMenuAction>
      <AriaMenuAction @label="Redo"><MdiIcon @name="Redo"/></AriaMenuAction>
      <AriaDropdownMenu @title="File">
        <AriaMenuAction @action={{action loadFile}}>Load</AriaMenuAction>
        <AriaMenuAction>Save</AriaMenuAction>
      </AriaDropdownMenu>
      <AriaMenuAction @current={{eq currentView '#tei-editor-main-text' true}} @hidden={{eq loaded false true}} @action={{action setView '#tei-editor-main-text'}}>Text</AriaMenuAction>
      <AriaMenuAction @hidden={{eq loaded false true}}>Annotations</AriaMenuAction>
      <AriaMenuAction @current={{eq currentView '#tei-editor-metadata' true}} @hidden={{eq loaded false true}} @action={{action setView '#tei-editor-metadata'}}>Metadata</AriaMenuAction>
    </AriaMenu>
  </div>
  <div aria-hidden={{eq loaded false true}}>
    <div id="tei-editor-main-text" aria-hidden="false">
      <div>
        <div class="tei-editor-main-text-editor">
          <div id={{prosemirrorId}}></div>
        </div>
      </div>
      <div>
        <div class="tei-editor-main-text-sidebar">
          <dl>
            {{#each mainTextSidebarConfig key="@index" as |section|}}
              {{#if (status-display-entry status section.test)}}
                <dt>{{section.title}}</dt>
                <dd>
                  <AriaMenu>
                    {{#each section.entries key="@index" as |entry index|}}
                      {{#if (eq entry.type 'select')}}
                        <li class="input">
                          <select role="menuitem" tabindex={{aria-menu-item-tabindex index}} onchange={{action menuAction entry.action entry.attribute 'ev.target.value'}}>
                            {{#each entry.values key="@index" as |value|}}
                              <option value={{value.key}} selected={{eq (get status entry.value_key) value.key}}>{{value.value}}</option>
                            {{/each}}
                          </select>
                        </li>
                      {{/if}}
                      {{#if (eq entry.type 'button')}}
                        <AriaMenuAction @tabindex={{aria-menu-item-tabindex index}} @label={{entry.label}} @action={{action menuAction entry.action entry.attribute entry.value}} @current={{eq (get status entry.value_key) entry.value true}}><MdiIcon @name={{entry.icon}} /></AriaMenuAction>
                      {{/if}}
                    {{/each}}
                  </AriaMenu>
                </dd>
              {{/if}}
            {{/each}}
          </dl>
        </div>
      </div>
    </div>
    <div id="tei-editor-metadata" aria-hidden="true">
      <dl>
        {{#each metadataConfig key="@index" as |section|}}
          <dt>{{section.title}}</dt>
          <dd>
            <ul>
              {{#each section.entries key="@index" as |entry|}}
                {{#if (eq entry.type 'single-text')}}
                  <li class="tei-editor-metadata-single"><label>{{entry.label}}<input type="text" value={{get metadata entry.value_key}} onchange={{action setMetadataField entry.value_key}}/></label></li>
                {{/if}}
                {{#if (eq entry.type 'multi-field')}}
                  <li class="tei-editor-metadata-multiple">
                    {{#each (get metadata entry.value_key) key="@index" as |value value_idx|}}
                    <div>
                      {{#each entry.entries key="@index" as |part_entry part_idx|}}
                        <div><label>{{part_entry.label}}<input type="text" value={{get value part_entry.value_key}} onchange={{action setMetadataField (join '.' entry.value_key value_idx part_entry.value_key)}}/></label></div>
                      {{/each}}
                      <nav>
                        <AriaMenu>
                          <AriaMenuAction @tabindex="0" @label="Delete this row" @action={{action removeMultiFieldRow entry.value_key value_idx}}><MdiIcon @name="Delete"/></AriaMenuAction>
                          <AriaMenuAction @tabindex="-1" @label="Move this row up one" @disabled={{array-first (get metadata entry.value_key) value_idx}} @action={{action moveMultiFieldRowUp entry.value_key value_idx}}><MdiIcon @name="ArrowUp"/></AriaMenuAction>
                          <AriaMenuAction @tabindex="-1" @label="Move this row one down" @disabled={{array-last (get metadata entry.value_key) value_idx}} @action={{action moveMultiFieldRowDown entry.value_key value_idx}}><MdiIcon @name="ArrowDown"/></AriaMenuAction>
                        </AriaMenu>
                      </nav>
                    </div>
                    {{/each}}
                    <AriaMenu>
                      <AriaMenuAction @tabindex="0" @label="Add a new row" @action={{action addMultiFieldRow entry.value_key entry.entries}}><MdiIcon @name="Plus"/></AriaMenuAction>
                    </AriaMenu>
                  </li>
                {{/if}}
              {{/each}}
            </ul>
          </dd>
        {{/each}}
      </dl>
    </div>
  </div>
</div>
