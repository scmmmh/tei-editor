(function(e){function t(t){for(var a,s,o=t[0],c=t[1],l=t[2],d=0,h=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&h.push(r[s][0]),r[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(h.length)h.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={app:0},i=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"37ba":function(e,t,n){},"6d73":function(e,t,n){"use strict";var a=n("37ba"),r=n.n(a);t["default"]=r.a},ba8f:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("tei-editor")],1)},i=[],s=n("d4ec"),o=n("bee2"),c=n("99de"),l=n("7e84"),u=n("262e"),d=n("9ab4"),h=n("60a3"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"tei-editor"}},[n("nav",[n("aria-menubar",{scopedSlots:e._u([{key:"default",fn:function(t){var a=t.keyboardNav,r=t.mouseClickNav;return[n("ul",{attrs:{role:"menubar"}},[e.hasSaveCallback||e.hasLoadCallback?n("li",{attrs:{role:"presentation"}},[n("a",{attrs:{role:"menuitem",tabindex:"0","aria-expanded":"false"},on:{keyup:a,click:r}},[e._v("File")]),n("aria-menu",{scopedSlots:e._u([{key:"default",fn:function(t){var a=t.keyboardNav,r=t.mouseClickNav;return[n("ul",{attrs:{role:"menu","aria-hidden":"true"}},[e.hasLoadCallback?n("li",{attrs:{role:"presentation"}},[n("a",{attrs:{role:"menuitem",tabindex:"-1"},on:{click:function(t){r(t),e.load()},keyup:a}},[e._v("Load")])]):e._e(),e.hasSaveCallback?n("li",{attrs:{role:"presentation"}},[n("a",{attrs:{role:"menuitem",tabindex:"-1"},on:{click:function(t){r(t),e.save()},keyup:a}},[e._v("Save")])]):e._e()])]}}],null,!0)})],1):e._e(),e._l(e.sections,(function(t,i,s){return n("li",{key:s,attrs:{role:"presentation"}},[n("a",{attrs:{role:"menuitem",tabindex:"-1","aria-checked":i===e.currentSection?"true":"false"},on:{click:function(t){r(t),e.setCurrentSection(i)},keyup:a}},[e._v(e._s(t.label))])])}))],2)]}}])})],1),n("div",[e._l(e.sections,(function(t,a,r){return[a===e.currentSection?["MetadataEditor"===t.type?n("metadata-editor",{key:r,attrs:{config:t}}):e._e(),"TextEditor"===t.type?n("text-editor",{key:r,attrs:{section:a}}):e._e()]:e._e()]}))],2)])},f=[],v=(n("b64b"),n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0"),function(e){function t(){return Object(s["a"])(this,t),Object(c["a"])(this,Object(l["a"])(t).apply(this,arguments))}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"render",value:function(){if(this.$scopedSlots.default)return this.$scopedSlots.default({keyboardNav:this.keyboardNavigation,mouseClickNav:this.mouseClickNavigation})}},{key:"keyboardNavigation",value:function(e){var t=e.target;if(t)if(39===e.keyCode){var n=this.findNextMenuitem(this.getParentMenubar(t),t,"next");n&&n.focus()}else if(37===e.keyCode){var a=this.findNextMenuitem(this.getParentMenubar(t),t,"previous");a&&a.focus()}else if(38===e.keyCode||40===e.keyCode){var r=!0,i=!1,s=void 0;try{for(var o,c=t.parentElement.children[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var l=o.value;if("menu"===l.getAttribute("role")){l.setAttribute("aria-hidden","false"),t.setAttribute("aria-expanded","true");var u=this.findNextMenuitem(l,null,"next");u&&u.focus()}}}catch(m){i=!0,s=m}finally{try{r||null==c.return||c.return()}finally{if(i)throw s}}}else if(13===e.keyCode||32==e.keyCode){var d=!0,h=!1,p=void 0;try{for(var f,v=t.parentElement.children[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;if("menu"===b.getAttribute("role"))if("false"===b.getAttribute("aria-hidden"))b.setAttribute("aria-hidden","true"),t.setAttribute("aria-expanded","false");else{b.setAttribute("aria-hidden","false"),t.setAttribute("aria-expanded","true");var y=this.findNextMenuitem(b,null,"next");if(y)return void y.focus()}}}catch(m){h=!0,p=m}finally{try{d||null==v.return||v.return()}finally{if(h)throw p}}t.click()}}},{key:"mouseClickNavigation",value:function(e){var t=e.target;if(t){var n=!0,a=!1,r=void 0;try{for(var i,s=t.parentElement.children[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var o=i.value;if("menu"===o.getAttribute("role"))if("false"===o.getAttribute("aria-hidden"))o.setAttribute("aria-hidden","true"),t.setAttribute("aria-expanded","false");else{o.setAttribute("aria-hidden","false"),t.setAttribute("aria-expanded","true");var c=this.findNextMenuitem(o,null,"next");if(c)return void c.focus()}}}catch(l){a=!0,r=l}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}}}},{key:"getParentMenubar",value:function(e){return e?"menubar"===e.getAttribute("role")?e:this.getParentMenubar(e.parentElement):null}},{key:"findNextMenuitem",value:function(e,t,n){if(!e)return null;var a=[];if("next"===n)for(var r=e.children.length-1;r>=0;r--)a.push(e.children[r]);else for(var i=0;i<e.children.length;i++)a.push(e.children[i]);var s=0;t||(s=1);while(a.length>0){var o=a.pop();if(0===s&&o===t)s=1;else if(1===s&&"menuitem"===o.getAttribute("role")&&"true"!==o.getAttribute("aria-disabled"))return o;if("menu"!==o.getAttribute("role"))if("next"===n)for(var c=o.children.length-1;c>=0;c--)a.push(o.children[c]);else for(var l=0;l<o.children.length;l++)a.push(o.children[l])}return null}}]),t}(h["c"]));v=d["a"]([Object(h["a"])({})],v);var b,y,m=v,g=m,k=n("6d73"),x=n("2877");function O(e){this["$style"]=k["default"].locals||k["default"]}var j=Object(x["a"])(g,b,y,!1,O,null,null),T=j.exports,S=function(e){function t(){return Object(s["a"])(this,t),Object(c["a"])(this,Object(l["a"])(t).apply(this,arguments))}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"render",value:function(){if(this.$scopedSlots.default)return this.$scopedSlots.default({keyboardNav:this.keyboardNavigation,mouseClickNav:this.mouseClickNavigation})}},{key:"keyboardNavigation",value:function(e){var t=e.target;if(t)if(39===e.keyCode);else if(37===e.keyCode);else if(38===e.keyCode){var n=this.findNextMenuitem(this.getParentMenu(t),t,"previous");n&&n.focus()}else if(40===e.keyCode){var a=this.findNextMenuitem(this.getParentMenu(t),t,"next");a&&a.focus()}else if(13===e.keyCode||32==e.keyCode)if(t.getAttribute("aria-expanded")){var r=!0,i=!1,s=void 0;try{for(var o,c=t.parentElement.children[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var l=o.value;if("menu"===l.getAttribute("role"))if("false"===l.getAttribute("aria-hidden"))l.setAttribute("aria-hidden","true"),t.setAttribute("aria-expanded","false");else{l.setAttribute("aria-hidden","false"),t.setAttribute("aria-expanded","true");var u=this.findNextMenuitem(l,null,"next");u&&u.focus()}}}catch(m){i=!0,s=m}finally{try{r||null==c.return||c.return()}finally{if(i)throw s}}}else t.click();else if(27===e.keyCode){var d=this.getParentMenu(t);if(d){d.setAttribute("aria-hidden","true");var h=!0,p=!1,f=void 0;try{for(var v,b=d.parentElement.children[Symbol.iterator]();!(h=(v=b.next()).done);h=!0){var y=v.value;"menuitem"===y.getAttribute("role")&&(y.setAttribute("aria-expanded","false"),y.focus())}}catch(m){p=!0,f=m}finally{try{h||null==b.return||b.return()}finally{if(p)throw f}}}}}},{key:"mouseClickNavigation",value:function(e){var t=e.target;if(t)if(t.getAttribute("aria-expanded")){var n=!0,a=!1,r=void 0;try{for(var i,s=t.parentElement.children[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var o=i.value;if("menu"===o.getAttribute("role"))if("false"===o.getAttribute("aria-hidden"))o.setAttribute("aria-hidden","true"),t.setAttribute("aria-expanded","false");else{o.setAttribute("aria-hidden","false"),t.setAttribute("aria-expanded","true");var c=this.findNextMenuitem(o,null,"next");c&&c.focus()}}}catch(b){a=!0,r=b}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}}else{var l=this.getParentMenu(t);if(l){l.setAttribute("aria-hidden","true");var u=!0,d=!1,h=void 0;try{for(var p,f=l.parentElement.children[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var v=p.value;"menuitem"===v.getAttribute("role")&&(v.setAttribute("aria-expanded","false"),v.focus())}}catch(b){d=!0,h=b}finally{try{u||null==f.return||f.return()}finally{if(d)throw h}}}}}},{key:"getParentMenu",value:function(e){return e?"menu"===e.getAttribute("role")?e:this.getParentMenu(e.parentElement):null}},{key:"getParentMenuOrMenubar",value:function(e){return e?"menu"===e.getAttribute("role")||"menubar"===e.getAttribute("role")?e:this.getParentMenuOrMenubar(e.parentElement):null}}]),t}(T);S=d["a"]([Object(h["a"])({})],S);var M,N,A=S,E=A,w=Object(x["a"])(E,M,N,!1,null,null,null),$=w.exports,_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"metadata-editor"},e._l(e.config.ui,(function(t,a){return n("section",{key:a},[n("h2",[e._v(e._s(t.label))]),e._l(t.entries,(function(e,t){return n("div",{key:t},[n("metadata-field",{attrs:{config:e}})],1)}))],2)})),0)},C=[],L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",["single-text"==e.config.type?[n("label",[n("span",{staticClass:"label-text"},[e._v(e._s(e.config.label))]),n("input",{attrs:{type:"text"},domProps:{value:e.value},on:{change:e.update}})])]:e._e(),"multi-row"==e.config.type?[n("ol",{staticClass:"multi-row"},e._l(e.value,(function(t,a){return n("li",{key:a},[e._l(e.config.entries,(function(t,r){return n("metadata-field",{key:r,attrs:{config:t,parent:e.parent+e.config.path+".["+a+"]"}})})),n("aria-menubar",{attrs:{items:e.modifyMenuItems(a)},on:{action:e.menuAction}}),n("aria-menubar",{scopedSlots:e._u([{key:"default",fn:function(t){var r=t.keyboardNav;return[n("ul",{attrs:{role:"menubar"}},[n("li",{attrs:{role:"presentation"}},[n("a",0===a?{attrs:{role:"menuitem","aria-disabled":!0}}:{attrs:{role:"menuitem",tabindex:1===e.value.length?null:0},on:{click:function(t){return e.menuAction("move-up:"+a)},keyup:r}},[n("svg",{attrs:{viewBox:"0 0 24 24","aria-label":"Move up"}},[n("path",{attrs:{d:"M19,3H5A2,2 0 0,0 3,5V19C3,20.11 3.9,21 5,21H19C20.11,21 21,20.11 21,19V5A2,2 0 0,0 19,3M16.59,15.71L12,11.12L7.41,15.71L6,14.29L12,8.29L18,14.29L16.59,15.71Z"}})])])]),n("li",{attrs:{role:"presentation"}},[a===e.value.length-1?n("a",{attrs:{role:"menuitem","aria-disabled":!0}},[n("svg",{attrs:{viewBox:"0 0 24 24","aria-label":"Move down"}},[n("path",{attrs:{d:"M19,3H5A2,2 0 0,0 3,5V19C3,20.11 3.9,21 5,21H19C20.11,21 21,20.11 21,19V5A2,2 0 0,0 19,3M12,15.71L6,9.71L7.41,8.29L12,12.88L16.59,8.29L18,9.71L12,15.71Z"}})])]):n("a",{attrs:{role:"menuitem",tabindex:1===e.value.length?null:0},on:{click:function(t){return e.menuAction("move-down:"+a)},keyup:r}},[n("svg",{attrs:{viewBox:"0 0 24 24","aria-label":"Move down"}},[n("path",{attrs:{d:"M19,3H5A2,2 0 0,0 3,5V19C3,20.11 3.9,21 5,21H19C20.11,21 21,20.11 21,19V5A2,2 0 0,0 19,3M12,15.71L6,9.71L7.41,8.29L12,12.88L16.59,8.29L18,9.71L12,15.71Z"}})])])]),n("li",{attrs:{role:"presentation"}},[n("a",{attrs:{role:"menuitem",tabindex:1===e.value.length?0:-1},on:{click:function(t){return e.menuAction("delete:"+a)},keyup:r}},[n("svg",{attrs:{viewBox:"0 0 24 24","aria-label":"Delete"}},[n("path",{attrs:{d:"M17,13H7V11H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"}})])])])])]}}],null,!0)})],2)})),0),n("aria-menubar",{scopedSlots:e._u([{key:"default",fn:function(t){var a=t.keyboardNav;return[n("ul",{attrs:{role:"menubar"}},[n("li",{attrs:{role:"presentation"}},[n("a",{attrs:{role:"menuitem",tabindex:"0"},on:{click:function(t){return e.menuAction("add")},keyup:a}},[n("svg",{attrs:{viewBox:"0 0 24 24","aria-label":"Add"}},[n("path",{attrs:{d:"M17,13H13V17H11V13H7V11H11V7H13V11H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"}})])])])])]}}],null,!1,3190783598)})]:e._e(),"multi-field"==e.config.type?[n("ol",{staticClass:"multi-field"},e._l(e.config.entries,(function(t,a){return n("li",{key:a},[n("metadata-field",{attrs:{config:t,parent:e.parent+e.config.path}})],1)})),0)]:e._e()],2)},D=[];n("4160"),n("c975"),n("a9e3"),n("25eb"),n("159b"),n("fb6a"),n("ac1f"),n("1276");function H(e,t){var n=t.split(".");while(e&&n.length>0){if("["===n[0][0]&&"]"===n[0][n[0].length-1]){var a=Number.parseInt(n[0].substring(1,n[0].length-1));a>=0&&a<e.length&&(e=e[a])}else e=e[n[0]];n=n.slice(1)}return e}var V=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(c["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.addMenuItems=[{label:'<svg viewBox="0 0 24 24" aria-label="Add"><path d="M17,13H13V17H11V13H7V11H11V7H13V11H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z" /></svg>',action:"add"}],e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"update",value:function(e){e&&e.target&&this.$store.commit("setMetadataValue",{path:this.$props.parent+this.$props.config.path,value:e.target.value})}},{key:"modifyMenuItems",value:function(e){return[{label:'<svg viewBox="0 0 24 24" aria-label="Move up"><path d="M19,3H5A2,2 0 0,0 3,5V19C3,20.11 3.9,21 5,21H19C20.11,21 21,20.11 21,19V5A2,2 0 0,0 19,3M16.59,15.71L12,11.12L7.41,15.71L6,14.29L12,8.29L18,14.29L16.59,15.71Z" /></svg>',action:"move-up:"+e,disabled:0===e},{label:'<svg viewBox="0 0 24 24" aria-label="Move down"><path d="M19,3H5A2,2 0 0,0 3,5V19C3,20.11 3.9,21 5,21H19C20.11,21 21,20.11 21,19V5A2,2 0 0,0 19,3M12,15.71L6,9.71L7.41,8.29L12,12.88L16.59,8.29L18,9.71L12,15.71Z" /></svg>',action:"move-down:"+e,disabled:e===this.value.length-1},{label:'<svg viewBox="0 0 24 24" aria-label="Delete"><path d="M17,13H7V11H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z" /></svg>',action:"delete:"+e}]}},{key:"menuAction",value:function(e){if("add"===e){var t={};this.$props.config.entries.forEach((function(e){var n=e.path;"."===n[0]&&(n=n.substring(1)),"single-text"===e.type?t[n]="":"multi-row"===e.type?t[n]=[]:"multi-field"===e.type&&e.entries.forEach((function(e){var n=e.path;"."===n[0]&&(n=n.substring(1)),"single-text"===e.type?t[n]="":"multi-row"===e.type&&(t[n]=[])}))})),this.$store.commit("addMetadataMuliRow",{path:this.$props.parent+this.$props.config.path,value:t})}else 0===e.indexOf("move-up:")?this.$store.commit("moveMetadataMultiRow",{path:this.$props.parent+this.$props.config.path,idx:Number.parseInt(e.substring(8)),move:-1}):0===e.indexOf("move-down:")?this.$store.commit("moveMetadataMultiRow",{path:this.$props.parent+this.$props.config.path,idx:Number.parseInt(e.substring(10)),move:1}):0===e.indexOf("delete:")&&this.$store.commit("removeMetadataMultiRow",{path:this.$props.parent+this.$props.config.path,value:Number.parseInt(e.substring(7))})}},{key:"value",get:function(){var e=H(this.$store.state.content[this.$store.state.settings.metadataSection],this.$props.parent+this.$props.config.path);return e||""}}]),t}(h["c"]);V=d["a"]([Object(h["a"])({components:{AriaMenubar:T},props:{config:Object,parent:{type:String,default:""}},name:"metadata-field"})],V);var P=V,I=P,R=Object(x["a"])(I,L,D,!1,null,null,null),B=R.exports,F=function(e){function t(){return Object(s["a"])(this,t),Object(c["a"])(this,Object(l["a"])(t).apply(this,arguments))}return Object(u["a"])(t,e),t}(h["c"]);F=d["a"]([Object(h["a"])({components:{MetadataField:B},props:{config:Object}})],F);var Z=F,J=Z,z=Object(x["a"])(J,_,C,!1,null,null,null),U=z.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-editor"},[n("div",{staticClass:"editor"}),n("aria-menubar",{scopedSlots:e._u([{key:"default",fn:function(t){var a=t.keyboardNav;return[n("div",{staticClass:"sidebar"},e._l(e.sidebar,(function(t,r){return n("div",{key:r,class:{"is-active":t.active}},[n("h2",[e._v(e._s(t.label))]),e._l(t.entities,(function(t,r){return["list"===t.type?n("ul",{key:r},e._l(t.entities,(function(t,a){return n("li",{key:a,attrs:{role:"presentation"}},[n("label",[n("span",{domProps:{innerHTML:e._s(t.label)}}),"setNodeAttrString"===t.type?n("input",{domProps:{value:t.value},on:{change:function(n){return e.menuAction(t,n)}}}):e._e()])])})),0):"menubar"===t.type?n("ul",{key:r,attrs:{role:"menubar"}},e._l(t.entities,(function(t,r){return n("li",{key:r,class:"separator"===t.type?"separator":null,attrs:{role:"presentation"}},["setNodeType"===t.type||"setNodeAttrValue"===t.type?n("a",{attrs:{role:"menuitem",tabindex:t.tabindex,"aria-label":t.ariaLabel,title:t.ariaLabel,"aria-checked":t.checked},domProps:{innerHTML:e._s(t.label)},on:{keyup:a,click:function(n){return e.menuAction(t)}}}):"selectNodeAttr"===t.type?n("select",{attrs:{role:"menuitem",tabindex:t.tabindex},on:{keyup:a,change:function(n){return e.menuAction(t,n)}}},e._l(t.values,(function(t){return n("option",{key:t.value,domProps:{value:t.value,selected:t.checked,innerHTML:e._s(t.label)}})})),0):"toggleMark"===t.type?n("a",{attrs:{role:"menuitem",tabindex:t.tabindex,"aria-label":t.ariaLabel,title:t.ariaLabel,"aria-checked":t.checked},domProps:{innerHTML:e._s(t.label)},on:{keyup:a,click:function(n){return e.menuAction(t)}}}):"selectMarkAttr"===t.type?n("select",{attrs:{role:"menuitem",tabindex:t.tabindex},on:{keyup:a,change:function(n){return e.menuAction(t,n)}}},e._l(t.values,(function(t){return n("option",{key:t.value,domProps:{value:t.value,selected:t.checked,innerHTML:e._s(t.label)}})})),0):"editNestedDoc"===t.type?n("a",{attrs:{role:"menuitem",tabindex:t.tabindex,"aria-label":t.ariaLabel,title:t.ariaLabel},domProps:{innerHTML:e._s(t.label)},on:{keyup:a,click:function(n){return e.menuAction(t)}}}):"closeNested"===t.type?n("a",{attrs:{role:"menuitem",tabindex:t.tabindex,"aria-label":t.ariaLabel,title:t.ariaLabel},domProps:{innerHTML:e._s(t.label)},on:{keyup:a,click:e.closeNestedAction}}):"linkNestedDoc"===t.type?n("select",{attrs:{role:"menuitem",tabindex:t.tabindex},on:{keyup:a,change:function(n){return e.menuAction(t,n)}}},e._l(t.values,(function(t){return n("option",{key:t.value,domProps:{value:t.value,selected:t.checked,innerHTML:e._s(t.label)}})})),0):e._e()])})),0):e._e()]}))],2)})),0)]}}])}),e.showNested?n("div",{staticClass:"nested"},[n("text-editor",{attrs:{section:e.section,nestedSection:e.nestedSettings.section,nestedId:e.nestedSettings.id,closeNestedAction:e.closeNestedEditor}})],1):e._e()],1)},Y=[],W=(n("d81d"),n("a434"),n("b0c0"),n("4fad"),n("bf19"),n("3835")),q=n("304a"),G=n("5313"),K=n("576a"),Q=n("0010"),ee=n("8726"),te=n("7f06"),ne=n("53ca");function ae(e){if(void 0!==e){if(null===e)return null;if(Array.isArray(e))return e.map((function(e){return ae(e)}));if("object"===Object(ne["a"])(e)){var t={};return Object.keys(e).forEach((function(n){t[n]=ae(e[n])})),t}return e}}n("7db0");var re=n("986d"),ie=n("0ac0");function se(e){var t={doc:{content:"block+"}};return e.forEach((function(e){"block"===e.type?t[e.name]={content:"inline*",group:"block",attrs:e.attrs,parseDOM:[{tag:"div.node-".concat(e.name),node:e.name,getAttrs:function(t){var n={};return e.attrs&&Object.keys(e.attrs).forEach((function(e){var a=t.getAttribute("data-".concat(e));a&&(n[e]=a)})),n}}],toDOM:function(t){var n={class:"node-".concat(e.name)};return Object.entries(t.attrs).forEach((function(e){var t=Object(W["a"])(e,2),a=t[0],r=t[1];n["data-".concat(a)]=r})),["div",n,0]}}:"wrapping"===e.type?t[e.name]={content:e.content+"+",group:"block",attrs:e.attrs,parseDOM:[{tag:"div.node-".concat(e.name),getAttrs:function(t){var n={};return e.attrs&&Object.keys(e.attrs).forEach((function(e){var a=t.getAttribute("data-".concat(e));a&&(n[e]=a)})),n}}],toDOM:function(t){var n={class:"node-".concat(e.name)};return Object.entries(t.attrs).forEach((function(e){var t=Object(W["a"])(e,2),a=t[0],r=t[1];n["data-".concat(a)]=r})),["div",n,0]}}:"inline"===e.type&&"text"===e.name?t.text={group:"inline"}:"inline"===e.type&&"text"!==e.name&&(t[e.name]={content:"inline*",group:"inline",inline:!0,attrs:e.attrs,parseDOM:[{tag:"span.node-".concat(e.name),getAttrs:function(t){var n={};return e.attrs&&Object.keys(e.attrs).forEach((function(e){var a=t.getAttribute("data-".concat(e));a&&(n[e]=a)})),n}}],toDOM:function(t){var n={class:"node-".concat(e.name)};return Object.entries(t.attrs).forEach((function(e){var t=Object(W["a"])(e,2),a=t[0],r=t[1];n["data-".concat(a)]=r})),["span",n,0]}})})),t}function oe(e){var t={};return e.forEach((function(e){"mark"===e.type&&(t[e.name]={attrs:e.attrs,parseDOM:[{tag:"span.mark-".concat(e.name),getAttrs:function(t){var n={};return e.attrs&&Object.keys(e.attrs).forEach((function(e){var a=t.getAttribute("data-".concat(e));a&&(n[e]=a)})),n}}],toDOM:function(t){var n={class:"mark-".concat(e.name)};return Object.entries(t.attrs).forEach((function(e){var t=Object(W["a"])(e,2),a=t[0],r=t[1];r&&(n["data-".concat(a)]=r)})),["span",n,0]}})})),t}function ce(e,t){if(!e||!t)return!1;var n=e.parent.childAfter(e.parentOffset);if(!n.node)return!1;var a=n.node.marks.find((function(e){return e.type===t}));if(!a)return!1;var r=e.index(),i=e.start()+n.offset,s=r+1,o=i+n.node.nodeSize;while(r>0&&a.isInSet(e.parent.child(r-1).marks))r-=1,i-=e.parent.child(r).nodeSize;while(s<e.parent.childCount&&a.isInSet(e.parent.child(s).marks))o+=e.parent.child(s).nodeSize,s+=1;return{from:i,to:o}}function le(e,t){return function(n,a){var r=n.tr,i=n.selection,s=n.doc,o=i.from,c=i.to,l=i.$from,u=i.empty;if(u){var d=ce(l,e);d&&(o=d.from,c=d.to)}var h=s.rangeHasMark(o,c,e);return h&&r.removeMark(o,c,e),r.addMark(o,c,e.create(t)),a(r)}}function ue(e){return function(t,n){var a=t.tr,r=t.selection,i=t.doc,s=r.from,o=r.to,c=r.$from,l=r.empty;if(l){var u=ce(c,e);u&&(s=u.from,o=u.to)}var d=i.rangeHasMark(s,o,e);if(d)return a.removeMark(s,o,e),n(a)}}function de(e,t){return function(n,a){var r=Object(re["findSelectedNodeOfType"])(e)(n.selection)||Object(re["findParentNodeOfType"])(e)(n.selection);if(r){var i=n.tr.replaceRangeWith(r.pos,r.pos+r.node.nodeSize,e.create(t,r.node.content));a(i)}}}function he(e,t){return function(n,a){var r=n.selection,i=r.$from,s=r.$to,o=i.blockRange(s);if(!o)return!1;var c=n.tr.setBlockType(o.$from.pos,o.$to.pos,t);c=c.wrap(o,[{type:e}]),a(c)}}function pe(e){return function(t,n){var a=t.selection,r=a.$from,i=a.$to,s=r.blockRange(i),o=s&&Object(ie["j"])(s);if(!s||null===o||void 0===o)return!1;var c=t.tr.lift(s,o);c=c.setBlockType(s.$from.pos,s.$to.pos,e),n(c)}}function fe(e,t,n){for(var a=0;a<t.length;a++)if("wrapping"===t[a].type&&Object(re["findParentNodeOfType"])(n.nodes[t[a].name])(e.selection))return!0;return!1}var ve=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(c["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.editor=null,e.showNested=!1,e.nestedSettings=null,e.internalContentUpdate=!1,e.stateDebounce=null,e.active={},e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"mounted",value:function(){var e=this;this.editor=new K["c"](this.$el.querySelector(".editor"),{state:G["EditorState"].create({schema:this.editorSchema,doc:this.doc?this.editorSchema.nodeFromJSON(this.doc):null,plugins:this.editorPlugins}),dispatchTransaction:function(t){if(e.editor){var n=e.editor.state.apply(t);e.stateChanged(n,t),e.internalContentUpdate=!0,e.$props.nestedSection&&e.$props.nestedId?e.$store.commit("setTextDoc",{path:e.$props.section+".nestedId."+e.$props.nestedSection+"."+e.$props.nestedId,doc:n.doc.toJSON()}):e.$store.commit("setTextDoc",{path:e.$props.section+".doc",doc:n.doc.toJSON()}),e.editor.updateState(n)}}})}},{key:"beforeDestroy",value:function(){this.editor&&this.editor.destroy()}},{key:"updateContent",value:function(e){!this.internalContentUpdate&&this.editor&&this.editor.updateState(G["EditorState"].create({schema:this.editorSchema,doc:this.editorSchema.nodeFromJSON(this.doc),plugins:this.editorPlugins})),this.internalContentUpdate=!1}},{key:"stateChanged",value:function(e,t){var n=this;null!==this.stateDebounce&&clearTimeout(this.stateDebounce),this.stateDebounce=setTimeout((function(){var t=e.selection,a=t.from,r=t.to,i={};e.doc.nodesBetween(a,r,(function(e){i[e.type.name]=e.attrs,e.marks&&e.marks.forEach((function(e){e.attrs?i[e.type.name]=e.attrs:i[e.type.name]={}}))})),n.active=i}),t.steps.length>0?500:50)}},{key:"menuAction",value:function(e,t){var n=this;if(this.editor)if("setNodeType"===e.type&&e.nodeType)if(this.editorSchema.nodes[e.nodeType].isInline){var a=this.editor.state.selection.content();if(this.active[e.nodeType]){var r=function t(a){return a.type.isBlock?n.editorSchema.nodes[a.type.name].create({},n.walkFragment(a.content,t)):a.type.isInline&&a.type.name===e.nodeType?n.editorSchema.text(a.textContent):a},i=this.walkFragment(a.content,r);this.editor.dispatch(this.editor.state.tr.replaceSelection(new q["Slice"](i,a.openStart,a.openEnd)))}else{var s=function t(a){return a.type.isBlock?n.editorSchema.nodes[a.type.name].create(a.attrs,n.walkFragment(a.content,t)):a.type.isText&&e.nodeType?n.editorSchema.nodes[e.nodeType].create({},a):a.type.isInline&&e.nodeType?n.editorSchema.nodes[e.nodeType].create(a.attrs,a.content):a},o=this.walkFragment(a.content,s);this.editor.dispatch(this.editor.state.tr.replaceSelection(new q["Slice"](o,a.openStart,a.openEnd)))}}else if(this.isWrappingType(e.nodeType)){for(var c="",l=0;l<this.schema.length;l++)this.schema[l].name===e.nodeType&&"wrapping"===this.schema[l].type&&(c=this.schema[l].content);he(this.editorSchema.nodes[e.nodeType],this.editorSchema.nodes[c])(this.editor.state,this.editor.dispatch)}else fe(this.editor.state,this.schema,this.editorSchema)?pe(this.editorSchema.nodes[e.nodeType])(this.editor.state,this.editor.dispatch):Object(Q["b"])(this.editorSchema.nodes[e.nodeType],{})(this.editor.state,this.editor.dispatch);else if("setNodeAttrValue"!==e.type&&"selectNodeAttr"!==e.type&&"setNodeAttrString"!==e.type||!e.nodeType){if("toggleMark"===e.type&&e.nodeType)Object(Q["c"])(this.editorSchema.marks[e.nodeType])(this.editor.state,this.editor.dispatch);else if("selectMarkAttr"===e.type&&e.nodeType){var u={};this.active[e.nodeType]&&(u=ae(this.active[e.nodeType])),e.attr&&(t&&t.target?u[e.attr]=t.target.value:e.value&&(u[e.attr]=e.value)),""===u[e.attr]?ue(this.editorSchema.marks[e.nodeType])(this.editor.state,this.editor.dispatch):le(this.editorSchema.marks[e.nodeType],u)(this.editor.state,this.editor.dispatch)}else if("linkNestedDoc"===e.type&&e.nodeType){var d={};this.active[e.nodeType]&&(d=ae(this.active[e.nodeType])),e.attr&&(t&&t.target?d[e.attr]=t.target.value:e.value&&(d[e.attr]=e.value)),de(this.editorSchema.nodes[e.nodeType],d)(this.editor.state,this.editor.dispatch)}else if("editNestedDoc"===e.type&&e.nodeType&&e.attr&&e.targetNodeType&&this.active[e.nodeType]){var h=this.active[e.nodeType][e.attr];if(!this.active[e.nodeType][e.attr]){var p=this.$store.state.content[this.$props.section].nested[e.targetNodeType];h=e.targetNodeType+"-1";var f=1;while(p&&p[h])f+=1,h=e.targetNodeType+"-"+f;var v={};this.active[e.nodeType]&&(v=ae(this.active[e.nodeType])),e.attr&&(v[e.attr]=h),de(this.editorSchema.nodes[e.nodeType],v)(this.editor.state,this.editor.dispatch),this.$store.commit("addNestedDoc",{path:this.$props.section+".nested."+e.targetNodeType+"."+h,doc:{type:"doc",content:[{type:"paragraph",content:[]}]}})}this.showNested=!0,this.nestedSettings={section:e.targetNodeType,id:h}}}else{var b={};this.active[e.nodeType]&&(b=ae(this.active[e.nodeType])),e.attr&&(t&&t.target?b[e.attr]=t.target.value:e.value&&(b[e.attr]=e.value)),this.editorSchema.nodes[e.nodeType].isInline?de(this.editorSchema.nodes[e.nodeType],b)(this.editor.state,this.editor.dispatch):Object(Q["b"])(this.editorSchema.nodes[e.nodeType],b)(this.editor.state,this.editor.dispatch)}}},{key:"closeNestedEditor",value:function(){this.showNested=!1,this.nestedSettings=null}},{key:"walkFragment",value:function(e,t){for(var n=0;n<e.childCount;n++)e=e.replaceChild(n,t(e.child(n)));return e}},{key:"isWrappingType",value:function(e){for(var t=0;t<this.schema.length;t++)if(this.schema[t].name===e&&"wrapping"===this.schema[t].type)return!0;return!1}},{key:"schema",get:function(){return this.$store.state.sections[this.$props.section].schema}},{key:"editorSchema",get:function(){return new q["Schema"]({nodes:se(this.schema),marks:oe(this.schema)})}},{key:"editorPlugins",get:function(){return[Object(ee["a"])(),Object(te["b"])({"Mod-z":ee["c"],"Mod-y":ee["b"]}),Object(te["b"])(Q["a"])]}},{key:"content",get:function(){return this.$store.state.content[this.$props.section]}},{key:"doc",get:function(){if(this.content){if(!this.$props.nestedSection||!this.$props.nestedId)return this.content.doc;if(this.content.nested&&this.content.nested[this.$props.nestedSection]&&this.content.nested[this.$props.nestedSection][this.$props.nestedId])return this.content.nested[this.$props.nestedSection][this.$props.nestedId].content[0]}return null}},{key:"ui",get:function(){return this.$props.nestedSection&&this.$store.state.sections[this.$props.section].ui[this.$props.nestedSection]?this.$store.state.sections[this.$props.section].ui[this.$props.nestedSection]:this.$store.state.sections[this.$props.section].ui.doc}},{key:"sidebar",get:function(){var e=this;return this.ui.map((function(t){return{label:t.label,active:!t.condition||e.active[t.condition.activeType],entities:t.entities?t.entities.map((function(t){return{type:t.type,entities:t.entities.map((function(t,n){var a={type:t.type,label:t.label,nodeType:t.nodeType||t.markType,attr:t.attr,value:t.value?t.value:"",values:[],checked:"false",tabindex:0===n?0:-1,ariaLabel:t.ariaLabel,targetNodeType:t.targetNodeType};return"setNodeType"===t.type?a.checked=t.nodeType&&e.active[t.nodeType]?"true":"false":"setNodeAttrValue"===t.type?a.checked=t.nodeType&&t.attr&&e.active[t.nodeType]&&e.active[t.nodeType][t.attr]===t.value?"true":"false":"selectNodeAttr"===t.type?a.values=t.values.map((function(n){return{value:n.value,label:n.label,checked:t.nodeType&&t.attr&&e.active[t.nodeType]&&e.active[t.nodeType][t.attr]===n.value?"selected":null}})):"toggleMark"===t.type?a.checked=t.markType&&e.active[t.markType]?"true":"false":"selectMarkAttr"===t.type?a.values=t.values.map((function(n){return{value:n.value,label:n.label,checked:t.markType&&t.attr&&e.active[t.markType]&&e.active[t.markType][t.attr]===n.value?"selected":null}})):"linkNestedDoc"===t.type?t.targetNodeType&&e.nestedDocIds[t.targetNodeType]&&(a.values=e.nestedDocIds[t.targetNodeType].map((function(n){return{value:n.value,label:n.label,checked:t.nodeType&&t.attr&&e.active[t.nodeType]&&e.active[t.nodeType][t.attr]===n.value?"selected":null}}))):"setNodeAttrString"===t.type&&(a.value=t.nodeType&&e.active[t.nodeType]&&e.active[t.nodeType][t.attr]?e.active[t.nodeType][t.attr]:""),a}))}})):[]}}))}},{key:"nestedDocIds",get:function(){var e={};return Object.entries(this.$store.state.content[this.$props.section].nested).forEach((function(t){var n=Object(W["a"])(t,2),a=n[0],r=n[1];e[a]=Object.keys(r).map((function(e){return{label:e,value:e}})),e[a].splice(0,0,{label:"New",value:""})})),e}}]),t}(h["c"]);d["a"]([Object(h["b"])({type:String})],ve.prototype,"section",void 0),d["a"]([Object(h["b"])({type:String})],ve.prototype,"nestedSection",void 0),d["a"]([Object(h["b"])({type:String})],ve.prototype,"nestedId",void 0),d["a"]([Object(h["b"])({type:Function})],ve.prototype,"closeNestedAction",void 0),d["a"]([Object(h["d"])("doc")],ve.prototype,"updateContent",null),ve=d["a"]([Object(h["a"])({components:{AriaMenubar:T},name:"text-editor"})],ve);var be=ve,ye=be,me=Object(x["a"])(ye,X,Y,!1,null,null,null),ge=me.exports,ke=(n("99af"),n("4de4"),n("a15b"),n("25f0"),n("6062"),n("5319"),function(){function e(){Object(s["a"])(this,e)}return Object(o["a"])(e,[{key:"serialise",value:function(e,t){var n=this,a={node:"tei:TEI",attrs:{"xmlns:tei":["http://www.tei-c.org/ns/1.0"]},children:[]};Object.entries(t).forEach((function(t){var r=Object(W["a"])(t,2),i=r[0],s=r[1];"MetadataEditor"===s.type&&n.mergeTrees(a,n.serialiseHeader(e[i],s))})),Object.entries(t).forEach((function(t){var r=Object(W["a"])(t,2),i=r[0],s=r[1];"TextEditor"===s.type&&n.mergeTrees(a,n.serialiseSingleText(e[i],s))}));var r=this.toString(a,"");return r.splice(0,0,'<?xml version="1.0" encoding="UTF-8"?>'),r.push(""),r.join("\n")}},{key:"mergeTrees",value:function(e,t){if(e&&t)for(var n=0;n<t.children.length;n++){for(var a=!1,r=0;r<e.children.length;r++)e.children[r].node===t.children[n].node&&this.objectsMatch(e.children[r].attrs,t.children[n].attrs)&&(this.mergeTrees(e.children[r],t.children[n]),a=!0);a||e.children.push(t.children[n])}}},{key:"objectsMatch",value:function(e,t){var n=this;if(e&&t){if(Object(ne["a"])(e)!==Object(ne["a"])(t))return!1;if("string"===typeof e||"number"===typeof e||"boolean"===typeof e)return e===t;var a=Object.keys(e),r=Object.keys(t);return a.forEach((function(a){return!(r.indexOf(a)<0)&&(!!n.objectsMatch(e[a],t[a])&&void r.splice(r.indexOf(a),1))})),!(r.length>0)}return!e&&!t}},{key:"serialiseSingleText",value:function(e,t){var n=this;if(e){var a=t.serialiser.tag.split("/");this.nested={};var r={node:a[a.length-1],children:e.doc.content.map((function(e){return n.serialiseTextNode(e,t.schema)})),attrs:{}};t.serialiser.attrs&&Object.entries(t.serialiser.attrs).forEach((function(e){var t=Object(W["a"])(e,2),n=t[0],a=t[1];r.attrs[n]?r.attrs[n].push(a):r.attrs[n]=[a]})),Object.entries(this.nested).forEach((function(a){var i=Object(W["a"])(a,2),s=i[0],o=i[1];new Set(o).forEach((function(a){e.nested[s]&&e.nested[s][a]&&r.children.push(n.serialiseTextNode(e.nested[s][a],t.schema))}))}));for(var i=a.length-2;i>=0;i--)r={node:a[i],children:[r]};return{node:"tei:TEI",children:[r]}}return null}},{key:"serialiseTextNode",value:function(e,t){var n=this,a=t.filter((function(t){return t.name===e.type&&t.serialiser}));if(1===a.length){a=a[0];var r={node:a.serialiser.tag,attrs:{},children:[],text:null};if(a.serialiser.attrs&&Object.entries(a.serialiser.attrs).forEach((function(e){r.attrs[e[0]]=[e[1]]})),e.attrs&&Object.entries(e.attrs).forEach((function(e){var t=a.attrs[e[0]].serialiser;if(t){var n=void 0;t.values?t.values[e[1]]&&(n=t.values[e[1]]):n=t.value?t.value.replace("{value}",e[1]):e[1],void 0!==n&&("text()"===t.attr?r.text=n:r.attrs[t.attr]?r.attrs[t.attr].push(n):r.attrs[t.attr]=[n])}})),"inline"===a.type){if(e.content)if(e.content.length>1||e.content[0].marks&&e.content[0].marks.length>0)e.content.forEach((function(e){r.children.push(n.serialiseTextNode(e,t))}));else{var i=this.serialiseTextNode(e.content[0],t);a.serialiser.text?r.attrs[a.serialiser.text.attr]?r.attrs[a.serialiser.text.attr].push(i.text):r.attrs[a.serialiser.text.attr]=[i.text]:r.text=i.text}else e.text&&(a.serialiser.text?r.attrs[a.serialiser.text.attr]?r.attrs[a.serialiser.text.attr].push(e.text):r.attrs[a.serialiser.text.attr]=[e.text]:r.text=e.text);if(e.marks){var s=e.marks.map((function(e){var n=t.filter((function(t){return t.name===e.type&&t.serialiser}));if(1===n.length){n=n[0];var a={node:r.node,attrs:{}},i=n.serialiser;return i.tag&&(a.node=i.tag),i.attrs&&Object.entries(i.attrs).forEach((function(e){e[1].value&&(a.attrs[e[0]]?a.attrs[e[0]].push(e[1].value):a.attrs[e[0]]=[e[1].value])})),e.attrs&&Object.entries(e.attrs).forEach((function(e){var t=void 0;n.attrs[e[0]].serialiser.value?t=n.attrs[e[0]].serialiser.value.replace("{value}",e[1]):n.attrs[e[0]].serialiser.values&&n.attrs[e[0]].serialiser.values[e[1]]&&(t=n.attrs[e[0]].serialiser.values[e[1]]),void 0!==t&&(a.attrs[n.attrs[e[0]].serialiser.attr]?a.attrs[n.attrs[e[0]].serialiser.attr].push(t):a.attrs[n.attrs[e[0]].serialiser.attr]=[t])})),a}return null})).filter((function(e){return e}));if(new Set(s.map((function(e){return e.node}))).size>1){s.sort((function(e,t){return e.node<t.node?-1:e.node>t.node?1:e.node===t.node?0:void 0}));var o=r;o.node=null,s.forEach((function(e){if(null===o.node||o.node===e.node)o.node=e.node,Object.entries(e.attrs).forEach((function(e){o.attrs[e[0]]?o.attrs[e[0]]=o.attrs[e[0]].concat(e[1]):o.attrs[e[0]]=e[1]}));else{var t={node:e.node,attrs:e.attrs,children:[],text:o.text};o.text=null,o.children.push(t),o=t}}))}else s.forEach((function(e){e&&(e.node&&(r.node=e.node),e.attrs&&Object.entries(e.attrs).forEach((function(e){r.attrs[e[0]]?r.attrs[e[0]]=r.attrs[e[0]].concat(e[1]):r.attrs[e[0]]=e[1]})))}))}}else e.content&&e.content.forEach((function(e){"doc"===e.type?e.content&&e.content.forEach((function(e){r.children.push(n.serialiseTextNode(e,t))})):r.children.push(n.serialiseTextNode(e,t))}));return a.reference&&(this.nested[a.reference.type]||(this.nested[a.reference.type]=[]),this.nested[a.reference.type].push(e.attrs[a.reference.attr])),r.children.length>0||r.text||Object.keys(r.attrs).length>0?r:null}return null}},{key:"serialiseHeader",value:function(e,t){var n=this;return{node:"tei:TEI",children:[{node:"tei:teiHeader",children:t.schema.map((function(t){return n.serialiseMetadataNode(e[t.tag.substring(4)],t)}))}]}}},{key:"serialiseMetadataNode",value:function(e,t){var n=this;if(t.multiple){var a=e.map((function(e){var a={node:t.tag};if(e._text&&(a.text=e._text),e._attrs&&(a.attrs={},Object.entries(e._attrs).forEach((function(e){a.attrs[e[0]]=[e[1]]}))),t.children){a.children=[];for(var r=0;r<t.children.length;r++)if(e[t.children[r].tag.substring(4)]){var i=n.serialiseMetadataNode(e[t.children[r].tag.substring(4)],t.children[r]);Array.isArray(i)?a.children=a.children.concat(i):a.children.push(i)}}return a}));return a}var r={node:t.tag};if(e&&(e._text&&(r.text=e._text),e._attrs&&(r.attrs={},Object.entries(e._attrs).forEach((function(e){r.attrs[e[0]]=[e[1]]}))),t.children)){r.children=[];for(var i=0;i<t.children.length;i++)if(e[t.children[i].tag.substring(4)]){var s=this.serialiseMetadataNode(e[t.children[i].tag.substring(4)],t.children[i]);Array.isArray(s)?r.children=r.children.concat(s):r.children.push(s)}}return r}},{key:"toString",value:function(e,t){var n=this;function a(e){return e.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}var r=[];if(e){var i=[t,"<",e.node];e.attrs&&Object.entries(e.attrs).forEach((function(e){e[1].length>0&&(e[1].sort(),i.push(" "+e[0]+'="'+a(e[1].join(" "))+'"'))})),e.children&&e.children.length>0?(i.push(">"),r.push(i.join("")),e.children.forEach((function(e){r=r.concat(n.toString(e,t+"  "))})),r.push(t+"</"+e.node+">")):(e.text?(i.push(">"),i.push(a(e.text)),i.push("</"+e.node+">")):i.push("/>"),r.push(i.join("")))}return r}}]),e}()),xe=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(c["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.currentSection=null,e}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"setCurrentSection",value:function(e){this.currentSection=e}},{key:"getContentForSection",value:function(e){return H(this.$store.state.content,e)}},{key:"setContentForSection",value:function(e,t){this.$store.commit("setTextDoc",{path:e,doc:t})}},{key:"mounted",value:function(){var e=Object.keys(this.sections);e.length>0&&(this.currentSection=e[0])}},{key:"save",value:function(){if(this.hasSaveCallback){var e=new ke;this.$store.state.callbacks.save(e.serialise(this.$store.state.content,this.$store.state.sections))}}},{key:"load",value:function(){var e=this;this.hasLoadCallback&&this.$store.state.callbacks.load((function(t){e.$store.dispatch("load",t)}))}},{key:"updateSections",value:function(){var e=Object.keys(this.sections);e.length>0&&(this.currentSection=e[0])}},{key:"sections",get:function(){return this.$store.state.sections}},{key:"hasSaveCallback",get:function(){return!!this.$store.state.callbacks.save}},{key:"hasLoadCallback",get:function(){return!!this.$store.state.callbacks.load}}]),t}(h["c"]);d["a"]([Object(h["d"])("sections")],xe.prototype,"updateSections",null),xe=d["a"]([Object(h["a"])({components:{AriaMenubar:T,AriaMenu:$,MetadataEditor:U,TextEditor:ge}})],xe);var Oe=xe,je=Oe,Te=(n("e215"),Object(x["a"])(je,p,f,!1,null,null,null)),Se=Te.exports,Me=function(e){function t(){return Object(s["a"])(this,t),Object(c["a"])(this,Object(l["a"])(t).apply(this,arguments))}return Object(u["a"])(t,e),Object(o["a"])(t,[{key:"mounted",value:function(){var e=this,t=document.getElementById("TEIEditorConfig");if(t){var n=JSON.parse(t.innerHTML);n&&this.$store.commit("init",n)}this.$store.state.callbacks&&this.$store.state.callbacks.autoLoad&&this.$store.state.callbacks.autoLoad((function(t){e.$store.dispatch("load",t)}))}}]),t}(h["c"]);Me=d["a"]([Object(h["a"])({components:{TeiEditor:Se}})],Me);var Ne=Me,Ae=Ne,Ee=Object(x["a"])(Ae,r,i,!1,null,null,null),we=Ee.exports,$e=n("2f62");function _e(e){return"tei"===e?"http://www.tei-c.org/ns/1.0":"xml"===e?"http://www.w3.org/XML/1998/namespace":"http://www.tei-c.org/ns/1.0"}var Ce=function(){function e(t){Object(s["a"])(this,e),this.dom=t}return Object(o["a"])(e,[{key:"evaluate",value:function(e,t,n){return this.dom.evaluate(t,e,_e,n,null)}},{key:"firstNode",value:function(e,t){return this.evaluate(e,t,XPathResult.FIRST_ORDERED_NODE_TYPE).singleNodeValue}},{key:"nodeIterator",value:function(e,t){return this.evaluate(e,t,XPathResult.ORDERED_NODE_ITERATOR_TYPE)}},{key:"stringValue",value:function(e,t){return this.evaluate(e,t,XPathResult.STRING_TYPE).stringValue}},{key:"booleanValue",value:function(e,t){return this.evaluate(e,t,XPathResult.BOOLEAN_TYPE).booleanValue}},{key:"numberValue",value:function(e,t){return this.evaluate(e,t,XPathResult.NUMBER_TYPE).numberValue}}]),e}(),Le=function(){function e(t,n){Object(s["a"])(this,e),this.dom=t,this.xpath=new Ce(this.dom),this.config=n}return Object(o["a"])(e,[{key:"get",value:function(){if(!this.data){var e=this.xpath.firstNode(this.dom.documentElement,"/tei:TEI/tei:teiHeader");this.data={};for(var t=0;t<this.config.schema.length;t++){var n=this.parseHeaderNode(e,this.config.schema[t]);n&&(this.data[this.config.schema[t].tag.substring(4)]=n)}}return this.data}},{key:"parseHeaderNode",value:function(e,t){var n=this.xpath.nodeIterator(e,t.tag),a=[],r=n.iterateNext();while(r){for(var i={_attrs:{},_text:0===r.children.length?this.xpath.stringValue(r,"text()"):null},s=0;s<r.attributes.length;s++)i._attrs[r.attributes[s].name]=r.attributes[s].value;if(t.children)for(var o=0;o<t.children.length;o++){var c=this.parseHeaderNode(r,t.children[o]);c&&(i[t.children[o].tag.substring(t.children[o].tag.indexOf(":")+1)]=c)}a.push(i),r=n.iterateNext()}return 0===a.length?null:t.multiple?a:a[0]}}]),e}(),De=function(){function e(t,n){Object(s["a"])(this,e),this.dom=t,this.xpath=new Ce(this.dom),this.config=n}return Object(o["a"])(e,[{key:"get",value:function(){if(!this.doc&&(this.doc={type:"doc",content:[]},this.nestedDocs={},this.config.parser&&this.config.parser.selector)){var e=this.xpath.firstNode(this.dom.documentElement,this.config.parser.selector);if(e)for(var t=0;t<e.children.length;t++){var n=this.parseContentNode(e.children[t],this.config);n&&!n.nestedDoc?this.doc.content.push(n):n&&n.nestedDoc&&this.addNestedDoc(n)}}return[this.doc,this.nestedDocs]}},{key:"parseContentAttributes",value:function(e,t){var n=this,a={};return Object.entries(t).forEach((function(t){var r=Object(W["a"])(t,2),i=r[0],s=r[1],o=[];s.parser?o.push(s.parser):s.parsers&&(o=s.parsers);for(var c=0;c<o.length;c++){var l=o[c];if("boolean"===l.type)a[i]=n.xpath.booleanValue(e,l.selector);else if("number"===l.type)try{a[i]=n.xpath.numberValue(e,l.selector)}catch(d){console.log(d)}else if("static"===l.type)n.xpath.booleanValue(e,l.selector)&&(a[i]=l.value);else try{var u=n.xpath.stringValue(e,l.selector);u&&(a[i]=u)}catch(d){console.log(d)}}})),a}},{key:"parseContentMarks",value:function(e,t){var n=this,a=[];return t.forEach((function(t){if("mark"===t.type){var r=[];t.parser?r.push(t.parser):t.parsers&&(r=t.parsers);for(var i=0;i<r.length;i++)if(n.xpath.booleanValue(e,r[i].selector)){var s={type:t.name};t.attrs&&(s.attrs=n.parseContentAttributes(e,t.attrs)),a.push(s)}}})),a}},{key:"parseContentNode",value:function(e,t){for(var n=Object.entries(t.schema),a=0;a<n.length;a++){var r=n[a][1],i=[];r.parser?i.push(r.parser):r.parsers&&(i=i.concat(r.parsers));for(var s=0;s<i.length;s++){var o=i[s];if(null!==this.xpath.firstNode(e,"self::"+o.selector)){var c={type:r.name};if(r.attrs&&(c.attrs=this.parseContentAttributes(e,r.attrs)),"nested"===r.type&&(c.nestedDoc=!0),"inline"===r.type)if("text"===r.name){if(c.text=this.xpath.stringValue(e,o.text),c.marks=this.parseContentMarks(e,t.schema),1===e.children.length){var l=this.parseContentNode(e.children[0],t);l.text&&""!==l.text&&(c.text=l.text),c.marks=c.marks.concat(l.marks)}}else if(0===e.children.length)this.xpath.stringValue(e,o.text)&&(c.content=[{type:"text",text:this.xpath.stringValue(e,o.text),marks:this.parseContentMarks(e,t.schema)}]);else{for(var u=[],d=0;d<e.children.length;d++){var h=this.parseContentNode(e.children[d],t);h&&u.push(h)}c.content=u}else{for(var p=[],f=0;f<e.children.length;f++){var v=this.parseContentNode(e.children[f],t);v&&!v.nestedDoc?p.push(v):v&&v.nestedDoc&&this.addNestedDoc(v)}c.content=p}return c}}}return null}},{key:"addNestedDoc",value:function(e){if(e.attrs&&e.attrs.id){this.nestedDocs[e.type]||(this.nestedDocs[e.type]={}),this.nestedDocs[e.type][e.attrs.id]=e;var t={type:"doc",content:e.content};e.content=[t]}}}]),e}();a["a"].use($e["a"]);var He={settings:{metadataSection:""},sections:{},content:{},callbacks:{save:void 0,load:void 0,autoLoad:void 0}},Ve=new $e["a"].Store({state:He,mutations:{init:function(e,t){e.sections=t.sections,Object.keys(t.sections).forEach((function(n,r){"MetadataEditor"===t.sections[n].type&&(e.settings.metadataSection=n),a["a"].set(e.content,n,{}),a["a"].set(e.content[n],"doc",null),a["a"].set(e.content[n],"nested",{})})),window.TEIEditor&&window.TEIEditor.callbacks&&(a["a"].set(e.callbacks,"save",window.TEIEditor.callbacks.save),a["a"].set(e.callbacks,"load",window.TEIEditor.callbacks.load),a["a"].set(e.callbacks,"autoLoad",window.TEIEditor.callbacks.autoLoad))},setMetadata:function(e,t){a["a"].set(e.content,e.settings.metadataSection,t)},setMetadataValue:function(e,t){var n=e.content[e.settings.metadataSection];if(n){n=ae(n);var r=n,i=t.path.split(".");while(i.length>0){var s=i[0];if("["===s[0]&&"]"===s[s.length-1]&&Array.isArray(r)){var o=Number.parseInt(s.substring(1,s.length-1));o>=0&&o<r.length&&(i.length>1?r=r[o]:r[o]=t.value)}else r[s]?i.length>1?r=r[s]:r[s]=t.value:i.length>1?(r[s]={},r=r[s]):r[s]=t.value;i.splice(0,1)}a["a"].set(e.content,e.settings.metadataSection,n)}},addMetadataMuliRow:function(e,t){var n=e.content[e.settings.metadataSection];if(n){n=ae(n);var r=H(n,t.path);if(!r){for(var i=n,s=t.path.split("."),o=0;o<s.length;o++)i[s[o]]||(o<s.length-1?i[s[o]]={}:i[s[o]]=[]),i=i[s[o]];r=H(n,t.path)}r.push(t.value),a["a"].set(e.content,e.settings.metadataSection,n)}},removeMetadataMultiRow:function(e,t){var n=e.content[e.settings.metadataSection];if(n){n=ae(n);var r=H(n,t.path);r&&t.value>=0&&t.value<r.length&&(r.splice(t.value,1),a["a"].set(e.content,e.settings.metadataSection,n))}},moveMetadataMultiRow:function(e,t){var n=e.content[e.settings.metadataSection];if(n){n=ae(n);var r=H(n,t.path);if(r&&t.idx>=0&&t.idx<r.length&&t.idx+t.move>=0&&t.idx+t.move<r.length){var i=r[t.idx];r.splice(t.idx,1),r.splice(t.idx+t.move,0,i),a["a"].set(e.content,e.settings.metadataSection,n)}}},setTextDoc:function(e,t){var n=t.path.split(".");2===n.length?a["a"].set(e.content[n[0]],n[1],t.doc):4===n.length&&a["a"].set(e.content[n[0]].nested[n[2]][n[3]],"content",[t.doc])},addNestedDoc:function(e,t){var n=t.path.split(".");4===n.length&&(e.content[n[0]].nested[n[2]]||a["a"].set(e.content[n[0]].nested,n[2],{}),a["a"].set(e.content[n[0]].nested[n[2]],n[3],{attrs:{id:n[3]},content:[t.doc],nestedDoc:!0,type:n[2]}))}},actions:{load:function(e,t){var n=e.commit,r=e.state,i=new DOMParser,s=i.parseFromString(t,"application/xml");a["a"].set(r,"content",{}),Object.keys(r.sections).forEach((function(e,t){a["a"].set(r.content,e,{}),a["a"].set(r.content[e],"doc",null),a["a"].set(r.content[e],"nested",{})})),Object.entries(r.sections).forEach((function(e){var t=Object(W["a"])(e,2),a=t[0],r=t[1];if("MetadataEditor"===r.type)n("setMetadata",new Le(s,r).get());else if("TextEditor"===r.type){var i=new De(s,r).get(),o=Object(W["a"])(i,2),c=o[0],l=o[1];n("setTextDoc",{path:a+".doc",doc:c}),Object.entries(l).forEach((function(e){var t=Object(W["a"])(e,2),r=t[0],i=t[1];Object.entries(i).forEach((function(e){var t=Object(W["a"])(e,2),i=t[0],s=t[1];n("addNestedDoc",{path:a+".nested."+r+"."+i,doc:s.content[0]})}))}))}}))}},modules:{}});a["a"].config.productionTip=!1,new a["a"]({store:Ve,render:function(e){return e(we)}}).$mount("#app")},e215:function(e,t,n){"use strict";var a=n("ba8f"),r=n.n(a);r.a}});
//# sourceMappingURL=app.js.map